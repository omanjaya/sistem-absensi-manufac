import{a as C,u as F,f as R}from"./index-CpcTDv9q.js";import{d as A,r as u,o as M,b as P,e as l,E as o,s as a,q as p,v as f,U as k,F as D,z as E}from"./vendor-5hdk-FM1.js";const B={class:"container mx-auto px-4 py-6"},T={class:"bg-white rounded-lg shadow"},U={class:"p-6"},W={class:"max-w-2xl mx-auto"},G={class:"mb-8"},L={class:"bg-gray-100 rounded-lg p-6 text-center"},S={key:0,class:"py-12"},z={key:1,class:"space-y-4"},N={class:"flex justify-center space-x-4"},V=["disabled"],$={key:2,class:"py-12"},q={key:0,class:"mb-8"},H={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},I=["src","alt"],K=["onClick"],O={class:"mt-6 flex justify-center space-x-4"},J=["disabled"],Q=["disabled"],X={key:1,class:"bg-blue-50 rounded-lg p-6"},ae=A({__name:"FaceRegistration",setup(Y){const d=C(),_=F(),r=u(),m=u(!1),g=u(!1),h=u(!1),v=u(!1),s=u([]);let i=null;const x=async()=>{try{m.value=!1,i&&i.getTracks().forEach(e=>e.stop()),i=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}}),r.value&&(r.value.srcObject=i,await new Promise(e=>{r.value&&(r.value.onloadedmetadata=e)}),m.value=!0)}catch(e){d.error("Gagal mengakses kamera. Pastikan izin kamera telah diberikan."),console.error("Camera error:",e)}},y=async()=>{if(!(!r.value||!m.value))try{g.value=!0;const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("Canvas context not available");e.width=r.value.videoWidth,e.height=r.value.videoHeight,t.drawImage(r.value,0,0,e.width,e.height);const c=e.toDataURL("image/jpeg",.8);s.value.push(c),d.success(`Foto ${s.value.length} berhasil diambil`)}catch(e){d.error("Gagal mengambil foto"),console.error("Capture error:",e)}finally{g.value=!1}},w=e=>{s.value.splice(e,1)},j=async()=>{var e,t,c;if(s.value.length<3){d.error("Minimal 3 foto diperlukan untuk registrasi");return}try{h.value=!0;const n=await R.registerFace({user_id:((e=_.user)==null?void 0:e.id)||0,photos:s.value.map(b=>b.split(",")[1])});n.success?(v.value=!0,d.success("Wajah berhasil didaftarkan!"),i&&(i.getTracks().forEach(b=>b.stop()),i=null)):d.error(n.message||"Gagal mendaftarkan wajah")}catch(n){d.error(((c=(t=n.response)==null?void 0:t.data)==null?void 0:c.message)||"Gagal mendaftarkan wajah")}finally{h.value=!1}};return M(()=>{x()}),P(()=>{i&&i.getTracks().forEach(e=>e.stop())}),(e,t)=>(o(),l("div",B,[a("div",T,[t[4]||(t[4]=a("div",{class:"px-6 py-4 border-b border-gray-200"},[a("h1",{class:"text-xl font-semibold text-gray-900"},"Registrasi Wajah"),a("p",{class:"text-sm text-gray-600 mt-1"}," Daftarkan wajah Anda untuk sistem absensi dengan face recognition ")],-1)),a("div",U,[a("div",W,[a("div",G,[a("div",L,[m.value?v.value?(o(),l("div",$,t[1]||(t[1]=[k('<div class="text-green-600 mb-4"><svg class="w-16 h-16 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div><h3 class="text-lg font-semibold text-gray-900 mb-2">Registrasi Berhasil!</h3><p class="text-gray-600">Wajah Anda telah berhasil didaftarkan untuk sistem absensi.</p>',3)]))):(o(),l("div",z,[a("video",{ref_key:"videoRef",ref:r,autoplay:"",muted:"",class:"w-full max-w-md mx-auto rounded-lg shadow-lg"},null,512),a("div",N,[a("button",{onClick:y,disabled:g.value,class:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors"},f(g.value?"Memproses...":"Ambil Foto"),9,V),a("button",{onClick:x,class:"bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition-colors"}," Reset Kamera ")])])):(o(),l("div",S,t[0]||(t[0]=[a("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"},null,-1),a("p",{class:"text-gray-600"},"Mempersiapkan kamera...",-1)])))])]),s.value.length>0&&!v.value?(o(),l("div",q,[t[2]||(t[2]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Foto yang Diambil",-1)),a("div",H,[(o(!0),l(D,null,E(s.value,(c,n)=>(o(),l("div",{key:n,class:"relative"},[a("img",{src:c,alt:`Foto ${n+1}`,class:"w-full h-32 object-cover rounded-lg shadow"},null,8,I),a("button",{onClick:b=>w(n),class:"absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700"}," × ",8,K)]))),128))]),a("div",O,[s.value.length<5?(o(),l("button",{key:0,onClick:y,disabled:g.value,class:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors"}," Ambil Foto Lagi ("+f(s.value.length)+"/5) ",9,J)):p("",!0),s.value.length>=3?(o(),l("button",{key:1,onClick:j,disabled:h.value,class:"bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 transition-colors"},f(h.value?"Mendaftarkan...":"Daftarkan Wajah"),9,Q)):p("",!0)])])):p("",!0),v.value?p("",!0):(o(),l("div",X,t[3]||(t[3]=[k('<h3 class="text-lg font-semibold text-blue-900 mb-3">Petunjuk:</h3><ul class="text-blue-800 space-y-2"><li class="flex items-start"><span class="text-blue-600 mr-2">•</span> Pastikan wajah Anda terlihat jelas dan tidak tertutup </li><li class="flex items-start"><span class="text-blue-600 mr-2">•</span> Ambil foto minimal 3 kali dengan sudut yang berbeda </li><li class="flex items-start"><span class="text-blue-600 mr-2">•</span> Pastikan pencahayaan cukup dan tidak ada bayangan di wajah </li><li class="flex items-start"><span class="text-blue-600 mr-2">•</span> Tatap lurus ke kamera saat pengambilan foto </li></ul>',2)])))])])])]))}});export{ae as default};
